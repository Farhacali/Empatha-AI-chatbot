<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empatha - AI Wellness Companion</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Auth Overlay */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }

        .auth-overlay.hidden {
            display: none;
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 48px;
            width: 100%;
            max-width: 440px;
            text-align: center;
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin: 0 auto 24px;
        }

        .auth-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .auth-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 40px;
        }

        .auth-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 32px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: #ffffff;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-input {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #ffffff;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .auth-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border: none;
            border-radius: 12px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 16px;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .auth-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .guest-button {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .guest-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .auth-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .auth-success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        /* User Menu */
        .user-menu {
            position: relative;
            display: none;
        }

        .user-menu.visible {
            display: block;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 8px 0;
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .dropdown-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
        }

        /* Update existing styles to accommodate auth */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-size: 24px;
            font-weight: 700;
        }

        .logo-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .connection-status {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .connection-status.connected {
            color: #10b981;
        }

        .connection-status.disconnected {
            color: #ef4444;
        }

        /* Navigation */
        .nav-container {
            display: flex;
            justify-content: center;
            padding: 40px 20px;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 50px;
            padding: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: #ffffff;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .nav-icon {
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
        }

        /* Hero Section */
        .hero-text {
            text-align: center;
            font-size: 48px;
            font-weight: 400;
            line-height: 1.2;
            margin-bottom: 80px;
            color: rgba(255, 255, 255, 0.9);
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 80px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 28px;
        }

        .feature-icon.purple {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
        }

        .feature-icon.teal {
            background: linear-gradient(135deg, #14b8a6, #06b6d4);
        }

        .feature-icon.blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .feature-icon.orange {
            background: linear-gradient(135deg, #f97316, #ea580c);
        }

        .feature-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #ffffff;
        }

        .feature-description {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }

        /* CTA Buttons */
        .cta-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 80px;
            flex-wrap: wrap;
        }

        .cta-button {
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
        }

        .cta-primary {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: #ffffff;
        }

        .cta-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .cta-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cta-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        /* Content Sections */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Chat Section */
        .chat-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            height: 600px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
        }

        .status-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid #1a1a1a;
        }

        .status-dot.disconnected {
            background: #ef4444;
        }

        .chat-info h3 {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .chat-status {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        .messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            padding: 16px 20px;
            border-radius: 20px;
            max-width: 80%;
            line-height: 1.5;
            animation: slideIn 0.3s ease;
        }

        .message.ai {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            align-self: flex-start;
            border-bottom-left-radius: 8px;
        }

        .message.user {
            background: rgba(255, 255, 255, 0.1);
            align-self: flex-end;
            border-bottom-right-radius: 8px;
        }

        .message-tag {
            display: inline-block;
            padding: 4px 8px;
            margin-top: 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .emotion-happy { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .emotion-sad { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .emotion-caring { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .emotion-neutral { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }
        .emotion-concerned { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

        .actions-container {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .action-item {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
        }

        .action-success {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .action-error {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-input {
            padding: 20px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            padding: 16px 50px 16px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: #ffffff;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .message-input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .send-btn {
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border: none;
            border-radius: 50%;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: translateY(-50%) scale(1.1);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Mood Tracker Section */
        .mood-tracker {
            text-align: center;
        }

        .mood-header {
            margin-bottom: 40px;
        }

        .mood-header h2 {
            font-size: 36px;
            margin-bottom: 16px;
        }

        .mood-header p {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
        }

        .mood-selector {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
        }

        .mood-question {
            font-size: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .mood-options {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }

        .mood-option {
            flex: 1;
            min-width: 120px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 24px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mood-option:hover {
            border-color: #8b5cf6;
            transform: translateY(-4px);
        }

        .mood-option.selected {
            border-color: #14b8a6;
            background: rgba(20, 184, 166, 0.1);
        }

        .mood-emoji {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }

        .mood-label {
            font-weight: 600;
            font-size: 16px;
        }

        .mood-history {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
        }

        .mood-history h3 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .mood-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mood-entry:last-child {
            border-bottom: none;
        }

        /* Profile Section */
        .profile-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .profile-header h2 {
            font-size: 36px;
            margin-bottom: 16px;
        }

        .profile-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .profile-card h3 {
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle {
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle.active {
            background: #14b8a6;
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: #ffffff;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle.active::after {
            transform: translateX(24px);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border-radius: 20px;
            border-bottom-left-radius: 8px;
            max-width: 200px;
            animation: slideIn 0.3s ease;
        }

        .typing-text {
            font-size: 14px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            animation: typingDots 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDots {
            0%, 60%, 100% { 
                transform: scale(0.8); 
                opacity: 0.5; 
            }
            30% { 
                transform: scale(1.2); 
                opacity: 1; 
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .main-content {
                padding: 0 20px;
            }

            .hero-text {
                font-size: 32px;
                margin-bottom: 60px;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                padding: 4px;
            }

            .nav-tab {
                padding: 10px 16px;
                font-size: 14px;
            }

            .cta-section {
                flex-direction: column;
                align-items: center;
            }

            .mood-options {
                flex-direction: column;
            }

            .mood-option {
                min-width: auto;
            }

            .auth-container {
                margin: 20px;
                padding: 32px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Overlay -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-container">
            <div class="auth-logo">üíú</div>
            <h1 class="auth-title">Welcome to Empatha</h1>
            <p class="auth-subtitle">Your emotionally intelligent AI wellness companion</p>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-auth-tab="login">Sign In</div>
                <div class="auth-tab" data-auth-tab="register">Sign Up</div>
            </div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <div id="authMessage"></div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" name="password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="auth-button">Sign In</button>
                <button type="button" class="guest-button" id="guestButton">Continue as Guest</button>
            </form>

            <!-- Register Form -->
            <form class="auth-form" id="registerForm">
                <div id="registerMessage"></div>
                
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" name="name" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" name="password" placeholder="Create a password" required minlength="6">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" name="confirmPassword" placeholder="Confirm your password" required>
                </div>
                
                <button type="submit" class="auth-button">Sign Up</button>
                <button type="button" class="guest-button" id="guestButtonRegister">Continue as Guest</button>
            </form>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="logo-section">
            <div class="logo">üíú</div>
            <div class="logo-text">
                <div class="logo-title">Empatha</div>
                <div class="logo-subtitle">Always here to listen</div>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="connection-status">Connecting...</div>
            <div class="user-menu" id="userMenu">
                <div class="user-avatar" id="userAvatar"></div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="dropdown-item" id="profileMenuItem">
                        <span>üë§</span>
                        <span>Profile</span>
                    </div>
                    <div class="dropdown-item" id="settingsMenuItem">
                        <span>‚öôÔ∏è</span>
                        <span>Settings</span>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" id="logoutMenuItem">
                        <span>üö™</span>
                        <span>Sign Out</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-container">
        <div class="nav-tabs">
            <div class="nav-tab active" data-section="home">
                <span class="nav-icon">üè†</span>
                <span>Home</span>
            </div>
            <div class="nav-tab" data-section="chat">
                <span class="nav-icon">üí¨</span>
                <span>Chat</span>
            </div>
            <div class="nav-tab" data-section="mood">
                <span class="nav-icon">üìä</span>
                <span>Mood Tracker</span>
            </div>
            <div class="nav-tab" data-section="profile">
                <span class="nav-icon">üë§</span>
                <span>Profile</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Home Section -->
        <div class="content-section active" id="home">
            <div class="hero-text">
                Your emotionally intelligent AI companion for wellness and care
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon purple">üíú</div>
                    <h3 class="feature-title">Emotional Intelligence</h3>
                    <p class="feature-description">Understands and responds to your emotions with genuine compassion</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon teal">üí¨</div>
                    <h3 class="feature-title">Real-time Support</h3>
                    <p class="feature-description">24/7 availability for emotional support and wellness guidance</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon blue">üõ°Ô∏è</div>
                    <h3 class="feature-title">Safe & Secure</h3>
                    <p class="feature-description">Your conversations are private and handled with care</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon orange">‚ú®</div>
                    <h3 class="feature-title">Personalized Care</h3>
                    <p class="feature-description">Learns your patterns to provide tailored wellness support</p>
                </div>
            </div>

            <div class="cta-section">
                <button class="cta-button cta-primary" onclick="switchTab('chat')">
                    Start Chatting with Empatha
                </button>
                <button class="cta-button cta-secondary" onclick="switchTab('mood')">
                    Track Your Mood
                </button>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="content-section" id="chat">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-avatar">
                        üíú
                        <div class="status-dot" id="statusDot"></div>
                    </div>
                    <div class="chat-info">
                        <h3>Empatha</h3>
                        <div class="chat-status" id="chatStatus">Connecting...</div>
                    </div>
                </div>
                
                <div class="messages" id="messages">
                    <!-- Messages will be added here dynamically -->
                </div>
                
                <div class="chat-input">
                    <div class="input-wrapper">
                        <input type="text" class="message-input" placeholder="Share how you're feeling..." id="messageInput">
                        <button class="send-btn" id="sendBtn">‚û§</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mood Tracker Section -->
        <div class="content-section" id="mood">
            <div class="mood-tracker">
                <div class="mood-header">
                    <h2>Mood Tracker</h2>
                    <p>Track your emotional journey and discover patterns in your wellness</p>
                </div>

                <div class="mood-selector">
                    <div class="mood-question">
                        üíú How are you feeling right now?
                    </div>
                    <div class="mood-options">
                        <div class="mood-option" data-mood="very-happy">
                            <span class="mood-emoji">‚òÄÔ∏è</span>
                            <div class="mood-label">Very Happy</div>
                        </div>
                        <div class="mood-option" data-mood="happy">
                            <span class="mood-emoji">üòä</span>
                            <div class="mood-label">Happy</div>
                        </div>
                        <div class="mood-option" data-mood="neutral">
                            <span class="mood-emoji">üòê</span>
                            <div class="mood-label">Neutral</div>
                        </div>
                        <div class="mood-option" data-mood="sad">
                            <span class="mood-emoji">üò¢</span>
                            <div class="mood-label">Sad</div>
                        </div>
                        <div class="mood-option" data-mood="very-sad">
                            <span class="mood-emoji">‚ö°</span>
                            <div class="mood-label">Very Sad</div>
                        </div>
                    </div>
                </div>

                <div class="mood-history">
                    <h3>Recent Mood Entries</h3>
                    <div id="moodEntries">
                        <div class="mood-entry">
                            <span>üòä Happy</span>
                            <span style="color: rgba(255, 255, 255, 0.7);">2 hours ago</span>
                        </div>
                        <div class="mood-entry">
                            <span>üòê Neutral</span>
                            <span style="color: rgba(255, 255, 255, 0.7);">Yesterday</span>
                        </div>
                        <div class="mood-entry">
                            <span>‚òÄÔ∏è Very Happy</span>
                            <span style="color: rgba(255, 255, 255, 0.7);">2 days ago</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div class="content-section" id="profile">
            <div class="profile-section">
                <div class="profile-header">
                    <h2>Profile Settings</h2>
                    <p>Customize your Empatha experience</p>
                </div>

                <div class="profile-card">
                    <h3>üë§ Personal Information</h3>
                    <div class="setting-item">
                        <span>Name</span>
                        <span style="color: #14b8a6;" id="profileName">User</span>
                    </div>
                    <div class="setting-item">
                        <span>Email</span>
                        <span style="color: rgba(255, 255, 255, 0.7);" id="profileEmail">Not set</span>
                    </div>
                    <div class="setting-item">
                        <span>Account Type</span>
                        <span style="color: #14b8a6;" id="accountType">Guest</span>
                    </div>
                    <div class="setting-item">
                        <span>Joined</span>
                        <span style="color: rgba(255, 255, 255, 0.7);" id="joinedDate">Today</span>
                    </div>
                    <div class="setting-item">
                        <span>Sessions</span>
                        <span style="color: #14b8a6;" id="sessionCount">0</span>
                    </div>
                </div>

                <div class="profile-card">
                    <h3>üîî Notifications</h3>
                    <div class="setting-item">
                        <span>Daily Check-ins</span>
                        <div class="toggle active" data-setting="daily-checkins"></div>
                    </div>
                    <div class="setting-item">
                        <span>Mood Reminders</span>
                        <div class="toggle active" data-setting="mood-reminders"></div>
                    </div>
                    <div class="setting-item">
                        <span>Weekly Reports</span>
                        <div class="toggle" data-setting="weekly-reports"></div>
                    </div>
                </div>

                <div class="profile-card">
                    <h3>üõ°Ô∏è Privacy & Security</h3>
                    <div class="setting-item">
                        <span>Data Encryption</span>
                        <span style="color: #10b981;">Enabled</span>
                    </div>
                    <div class="setting-item">
                        <span>Anonymous Mode</span>
                        <div class="toggle" data-setting="anonymous-mode"></div>
                    </div>
                    <div class="setting-item">
                        <span>Chat History</span>
                        <span style="color: #14b8a6;" id="chatHistory">Private</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Updated AuthManager class for real API integration
        class AuthManager {
            constructor() {
                this.currentUser = null;
                this.isGuest = false;
                // REAL localStorage integration - uncomment for production
                this.token = localStorage.getItem('authToken');
                this.apiBaseUrl = process.env.NODE_ENV === 'production' 
                    ? 'https://your-domain.com/api' 
                    : 'http://localhost:3000/api'; // Change this to your server URL
                this.initializeAuth();
            }

            async initializeAuth() {
                // Check if user has a valid token
                if (this.token) {
                    try {
                        const profile = await this.fetchProfile();
                        if (profile.success) {
                            this.currentUser = profile.user;
                            this.hideAuthOverlay();
                            this.updateUserInterface();
                            return;
                        }
                    } catch (error) {
                        console.log('Token validation failed, removing invalid token');
                        this.clearAuth();
                    }
                }

                // Check if user is in guest mode
                const isGuest = localStorage.getItem('empathaIsGuest') === 'true';
                if (isGuest) {
                    const savedUser = localStorage.getItem('empathaUser');
                    if (savedUser) {
                        this.isGuest = true;
                        this.currentUser = JSON.parse(savedUser);
                        this.hideAuthOverlay();
                        this.updateUserInterface();
                        return;
                    }
                }

                // Show auth overlay if no valid authentication
                this.showAuthOverlay();
            }

            async fetchProfile() {
                const response = await fetch(`${this.apiBaseUrl}/auth/profile`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${this.token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Profile fetch failed');
                }

                return await response.json();
            }

            async login(email, password) {
                console.log('AuthManager.login called with:', email);
                
                // Basic validation
                if (!email || !password) {
                    this.showError('loginForm', 'Please fill in all fields.');
                    return false;
                }

                try {
                    console.log('Making login request to:', `${this.apiBaseUrl}/auth/login`);
                    
                    const response = await fetch(`${this.apiBaseUrl}/auth/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email, password })
                    });

                    console.log('Login response status:', response.status);
                    const data = await response.json();
                    console.log('Login response data:', data);

                    if (data.success) {
                        this.currentUser = data.user;
                        this.token = data.token;
                        
                        // Save to localStorage
                        localStorage.setItem('authToken', data.token);
                        localStorage.setItem('empathaUser', JSON.stringify(data.user));
                        localStorage.removeItem('empathaIsGuest');
                        
                        this.hideAuthOverlay();
                        this.updateUserInterface();
                        this.showSuccess('loginForm', 'Welcome back! Redirecting...');
                        return true;
                    } else {
                        this.showError('loginForm', data.message || 'Login failed');
                        return false;
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    
                    // Check if it's a network error
                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        this.showError('loginForm', 'Cannot connect to server. Please check if the backend is running.');
                    } else {
                        this.showError('loginForm', 'Connection error. Please check your internet connection and try again.');
                    }
                    return false;
                }
            }

            async register(name, email, password, confirmPassword) {
                console.log('AuthManager.register called with:', name, email);
                
                // Basic validation
                if (!name || !email || !password || !confirmPassword) {
                    this.showError('registerForm', 'Please fill in all fields.');
                    return false;
                }

                if (password !== confirmPassword) {
                    this.showError('registerForm', 'Passwords do not match.');
                    return false;
                }

                if (password.length < 6) {
                    this.showError('registerForm', 'Password must be at least 6 characters long.');
                    return false;
                }

                try {
                    console.log('Making register request to:', `${this.apiBaseUrl}/auth/register`);
                    
                    const response = await fetch(`${this.apiBaseUrl}/auth/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name, email, password })
                    });

                    console.log('Register response status:', response.status);
                    const data = await response.json();
                    console.log('Register response data:', data);

                    if (data.success) {
                        this.currentUser = data.user;
                        this.token = data.token;
                        
                        // Save to localStorage
                        localStorage.setItem('authToken', data.token);
                        localStorage.setItem('empathaUser', JSON.stringify(data.user));
                        localStorage.removeItem('empathaIsGuest');
                        
                        this.hideAuthOverlay();
                        this.updateUserInterface();
                        this.showSuccess('registerForm', 'Account created! Welcome to Empatha...');
                        return true;
                    } else {
                        this.showError('registerForm', data.message || 'Registration failed');
                        return false;
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    
                    // Check if it's a network error
                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        this.showError('registerForm', 'Cannot connect to server. Please check if the backend is running.');
                    } else {
                        this.showError('registerForm', 'Connection error. Please check your internet connection and try again.');
                    }
                    return false;
                }
            }

            continueAsGuest() {
                console.log('Continuing as guest');
                this.isGuest = true;
                this.currentUser = { 
                    name: 'Guest', 
                    email: 'guest@local', 
                    id: 'guest_' + Date.now(),
                    joinedDate: new Date().toISOString(),
                    sessionCount: 0
                };
                // Save to localStorage
                localStorage.setItem('empathaIsGuest', 'true');
                localStorage.setItem('empathaUser', JSON.stringify(this.currentUser));
                
                this.hideAuthOverlay();
                this.updateUserInterface();
                
                // Show a message about guest mode
                setTimeout(() => {
                    this.showNotification('Welcome! You\'re using guest mode. Your data will be saved locally.');
                }, 1000);
            }

            showNotification(message) {
                // Create notification element
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #8b5cf6, #a855f7);
                    color: white;
                    padding: 16px 24px;
                    border-radius: 12px;
                    box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
                    z-index: 1001;
                    animation: slideInRight 0.3s ease;
                    max-width: 300px;
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // Remove after 4 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.animation = 'slideOutRight 0.3s ease';
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.parentNode.removeChild(notification);
                            }
                        }, 300);
                    }
                }, 4000);
            }

            async logout() {
                try {
                    // Call logout endpoint if user is authenticated
                    if (this.token && !this.isGuest) {
                        await fetch(`${this.apiBaseUrl}/auth/logout`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${this.token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                    }
                } catch (error) {
                    console.error('Logout API call failed:', error);
                } finally {
                    this.clearAuth();
                }
            }

            clearAuth() {
                this.currentUser = null;
                this.token = null;
                this.isGuest = false;
                
                // Clear localStorage
                localStorage.removeItem('authToken');
                localStorage.removeItem('empathaUser');
                localStorage.removeItem('empathaIsGuest');
                localStorage.removeItem('sessionCount');
                localStorage.removeItem('moodEntries');
                
                this.showAuthOverlay();
                this.updateUserInterface();
                
                // Reset app state
                if (window.socket && window.socket.connected) {
                    window.socket.disconnect();
                }
                
                // Clear messages
                const messagesContainer = document.getElementById('messages');
                if (messagesContainer) {
                    messagesContainer.innerHTML = '';
                }
                
                // Switch to home tab
                switchTab('home');
            }

            async updateSettings(settings) {
                if (this.isGuest) {
                    // For guest users, just save locally
                    const user = JSON.parse(localStorage.getItem('empathaUser'));
                    user.settings = { ...(user.settings || {}), ...settings };
                    localStorage.setItem('empathaUser', JSON.stringify(user));
                    this.currentUser = user;
                    return true;
                }

                try {
                    const response = await fetch(`${this.apiBaseUrl}/auth/settings`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ settings })
                    });

                    const data = await response.json();

                    if (data.success) {
                        // Update local user data
                        this.currentUser.settings = data.settings;
                        localStorage.setItem('empathaUser', JSON.stringify(this.currentUser));
                        return true;
                    } else {
                        console.error('Settings update failed:', data.message);
                        return false;
                    }
                } catch (error) {
                    console.error('Settings update error:', error);
                    return false;
                }
            }

            async saveMoodEntry(mood, label) {
                if (this.isGuest) {
                    // For guest users, save locally (existing functionality)
                    return;
                }

                try {
                    const response = await fetch(`${this.apiBaseUrl}/mood`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ mood, label })
                    });

                    const data = await response.json();

                    if (!data.success) {
                        console.error('Mood save failed:', data.message);
                    }
                } catch (error) {
                    console.error('Mood save error:', error);
                }
            }

            async loadMoodHistory() {
                if (this.isGuest) {
                    // For guest users, load from localStorage (existing functionality)
                    return JSON.parse(localStorage.getItem('moodEntries') || '[]');
                }

                try {
                    const response = await fetch(`${this.apiBaseUrl}/mood`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        return data.moods.map(mood => ({
                            mood: mood.mood,
                            label: mood.label,
                            timestamp: mood.timestamp,
                            displayTime: this.formatTimeAgo(new Date(mood.timestamp))
                        }));
                    } else {
                        console.error('Mood history load failed:', data.message);
                        return [];
                    }
                } catch (error) {
                    console.error('Mood history load error:', error);
                    return [];
                }
            }

            formatTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 60) return diffMins <= 1 ? 'Just now' : `${diffMins} minutes ago`;
                if (diffHours < 24) return diffHours === 1 ? '1 hour ago' : `${diffHours} hours ago`;
                if (diffDays < 7) return diffDays === 1 ? 'Yesterday' : `${diffDays} days ago`;
                return date.toLocaleDateString();
            }

            showAuthOverlay() {
                document.getElementById('authOverlay').classList.remove('hidden');
            }

            hideAuthOverlay() {
                document.getElementById('authOverlay').classList.add('hidden');
            }

            updateUserInterface() {
                const userMenu = document.getElementById('userMenu');
                const userAvatar = document.getElementById('userAvatar');
                
                if (this.currentUser) {
                    userMenu.classList.add('visible');
                    userAvatar.textContent = this.currentUser.name.charAt(0).toUpperCase();
                    
                    // Update profile information
                    document.getElementById('profileName').textContent = this.currentUser.name;
                    document.getElementById('profileEmail').textContent = this.currentUser.email;
                    document.getElementById('accountType').textContent = this.isGuest ? 'Guest' : 'Registered';
                    document.getElementById('sessionCount').textContent = this.currentUser.sessionCount || 0;
                    
                    if (this.currentUser.joinedDate) {
                        const joinedDate = new Date(this.currentUser.joinedDate);
                        document.getElementById('joinedDate').textContent = joinedDate.toLocaleDateString();
                    }
                } else {
                    userMenu.classList.remove('visible');
                }
            }

            showError(formId, message) {
                const messageElement = formId === 'loginForm' ? 
                    document.getElementById('authMessage') : 
                    document.getElementById('registerMessage');
                
                messageElement.innerHTML = `<div class="auth-error">${message}</div>`;
            }

            showSuccess(formId, message) {
                const messageElement = formId === 'loginForm' ? 
                    document.getElementById('authMessage') : 
                    document.getElementById('registerMessage');
                
                messageElement.innerHTML = `<div class="auth-success">${message}</div>`;
            }

            getCurrentUserId() {
                return this.currentUser ? this.currentUser.id : 'anonymous';
            }

            isAuthenticated() {
                return this.currentUser !== null;
            }

            getAuthHeaders() {
                if (this.token && !this.isGuest) {
                    return {
                        'Authorization': `Bearer ${this.token}`,
                        'Content-Type': 'application/json'
                    };
                }
                return {
                    'Content-Type': 'application/json'
                };
            }
        }

        // Initialize authentication manager
        const authManager = new AuthManager();

        // Socket.io connection
        let socket;
        let userId;

        // DOM elements
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const connectionStatus = document.querySelector('.connection-status');
        const statusDot = document.getElementById('statusDot');
        const chatStatus = document.getElementById('chatStatus');

        // App state
        let isConnected = false;
        let sessionCount = parseInt(localStorage.getItem('sessionCount') || '0');
        let moodEntries = [];

        // Initialize socket connection after authentication
        function initializeSocket() {
            console.log('Initializing socket connection...');
            
            if (socket) {
                socket.disconnect();
            }
            
            try {
                // Real Socket.io connection
                socket = io();
                userId = authManager.getCurrentUserId();
                console.log('Socket created for user:', userId);

                // Connection timeout
                const connectionTimeout = setTimeout(() => {
                    console.log('Socket connection timeout - falling back to demo mode');
                    handleSocketFallback();
                }, 5000);

                // Real Socket.io event handlers
                socket.on('connect', () => {
                    clearTimeout(connectionTimeout);
                    console.log('‚úÖ Connected to server:', socket.id);
                    isConnected = true;
                    connectionStatus.textContent = 'Connected';
                    connectionStatus.classList.add('connected');
                    connectionStatus.classList.remove('disconnected');
                    chatStatus.textContent = 'Online and ready to help';
                    statusDot.classList.remove('disconnected');
                    
                    // Increment session count
                    sessionCount++;
                    localStorage.setItem('sessionCount', sessionCount.toString());
                    document.getElementById('sessionCount').textContent = sessionCount;

                    // Send user info to server
                    socket.emit('user_connected', {
                        userId: userId,
                        userName: authManager.currentUser?.name || 'Guest',
                        isGuest: authManager.isGuest
                    });
                });

                socket.on('connect_error', (error) => {
                    clearTimeout(connectionTimeout);
                    console.log('‚ùå Socket connection error:', error);
                    handleSocketFallback();
                });

                socket.on('disconnect', () => {
                    console.log('‚ùå Disconnected from server');
                    isConnected = false;
                    connectionStatus.textContent = 'Disconnected';
                    connectionStatus.classList.add('disconnected');
                    connectionStatus.classList.remove('connected');
                    chatStatus.textContent = 'Reconnecting...';
                    statusDot.classList.add('disconnected');
                });

                socket.on('response', (data) => {
                    removeTypingIndicator();
                    addMessage(data.response, false, data.emotion, data.actions);
                    sendBtn.disabled = false;
                });

                socket.on('error', (err) => {
                    removeTypingIndicator();
                    addMessage('Sorry, I encountered an issue. Please try again.', false);
                    console.error('Socket error:', err);
                    sendBtn.disabled = false;
                });

            } catch (error) {
                console.error('Socket initialization error:', error);
                handleSocketFallback();
            }
        }

        // Fallback to demo mode if socket connection fails
        function handleSocketFallback() {
            console.log('Falling back to demo mode');
            isConnected = true; // Set to true for demo mode
            connectionStatus.textContent = 'Demo Mode';
            connectionStatus.classList.add('connected');
            connectionStatus.classList.remove('disconnected');
            chatStatus.textContent = 'Demo mode - responses are simulated';
            statusDot.classList.remove('disconnected');
            
            // Increment session count
            sessionCount++;
            localStorage.setItem('sessionCount', sessionCount.toString());
            document.getElementById('sessionCount').textContent = sessionCount;
            
            // Show notification about demo mode
            setTimeout(() => {
                showNotification('Running in demo mode. Backend server not available.');
            }, 1000);
        }

        // Updated mood functionality to integrate with API
        async function addMoodEntry(mood, label) {
            const now = new Date();
            const entry = {
                mood,
                label,
                timestamp: now.toISOString(),
                displayTime: formatTimeAgo(now)
            };
            
            // Save to server if user is authenticated
            if (!authManager.isGuest) {
                await authManager.saveMoodEntry(mood, label);
            }
            
            // Always save locally for immediate UI update
            moodEntries.unshift(entry);
            moodEntries = moodEntries.slice(0, 10);
            localStorage.setItem('moodEntries', JSON.stringify(moodEntries));
            
            updateMoodHistory();
        }

        // Updated mood history loading
        async function loadMoodHistory() {
            if (authManager.isGuest) {
                moodEntries = JSON.parse(localStorage.getItem('moodEntries') || '[]');
            } else {
                try {
                    moodEntries = await authManager.loadMoodHistory();
                } catch (error) {
                    console.error('Failed to load mood history from server, using local data');
                    moodEntries = JSON.parse(localStorage.getItem('moodEntries') || '[]');
                }
            }
            updateMoodHistory();
        }

        // Updated settings functionality
        async function updateUserSettings(setting, value) {
            const settings = { [setting]: value };
            const success = await authManager.updateSettings(settings);
            
            if (!success && !authManager.isGuest) {
                console.error('Failed to update settings on server');
            }
        }

        // Real message sending
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message === '' || !isConnected) return;

            console.log('Sending message:', message);

            // Add user message to chat
            addMessage(message, true);
            messageInput.value = '';

            // Disable send button and show typing indicator
            sendBtn.disabled = true;
            showTypingIndicator();

            // Send message to server via socket or use demo mode
            if (socket && socket.connected) {
                console.log('Sending via socket');
                socket.emit('message', { message, userId });
            } else {
                console.log('Using demo mode response');
                // Demo mode - simulate AI response
                setTimeout(() => {
                    removeTypingIndicator();
                    
                    const aiResponse = generateDemoAIResponse(message);
                    const emotion = detectDemoEmotion(message);
                    
                    addMessage(aiResponse, false, emotion);
                    sendBtn.disabled = false;
                }, 1500 + Math.random() * 1000);
            }
        }

        // Demo AI response generation (fallback when backend is not available)
        function generateDemoAIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('sad') || message.includes('depressed') || message.includes('down')) {
                return "I hear that you're feeling sad, and I want you to know that it's completely okay to feel this way. Your emotions are valid. Would you like to talk about what's contributing to these feelings?";
            } else if (message.includes('happy') || message.includes('great') || message.includes('good')) {
                return "I'm so glad to hear you're feeling good! It's wonderful when we can recognize and appreciate positive moments. What's been contributing to your happiness today?";
            } else if (message.includes('anxious') || message.includes('worried') || message.includes('stress')) {
                return "Anxiety can feel overwhelming, but you're not alone in this. Taking a moment to acknowledge these feelings is already a brave step. Would some breathing exercises or grounding techniques be helpful right now?";
            } else if (message.includes('angry') || message.includes('frustrated') || message.includes('mad')) {
                return "Anger is a natural emotion, and it often signals that something important to you has been affected. It's okay to feel this way. Would you like to explore what might be underneath this frustration?";
            } else if (message.includes('tired') || message.includes('exhausted') || message.includes('sleep')) {
                return "Feeling tired can affect everything - our mood, thoughts, and ability to cope. Rest is so important for our wellbeing. Have you been able to get enough quality sleep lately?";
            } else if (message.includes('hello') || message.includes('hi') || message.includes('hey')) {
                return "Hello! I'm so glad you're here. I'm Empatha, and I'm here to listen and support you. How are you feeling today?";
            } else if (message.includes('help') || message.includes('support')) {
                return "I'm here to help and support you in whatever way I can. Whether you need someone to listen, want to explore your feelings, or are looking for coping strategies, I'm here for you. What would be most helpful right now?";
            } else {
                return "Thank you for sharing that with me. I'm here to listen and understand. Your feelings and experiences matter. Would you like to tell me more about what's on your mind?";
            }
        }

        function detectDemoEmotion(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('sad') || message.includes('depressed') || message.includes('down')) {
                return 'caring';
            } else if (message.includes('happy') || message.includes('great') || message.includes('good')) {
                return 'happy';
            } else if (message.includes('anxious') || message.includes('worried') || message.includes('stress')) {
                return 'concerned';
            } else if (message.includes('angry') || message.includes('frustrated') || message.includes('mad')) {
                return 'caring';
            } else {
                return 'neutral';
            }
        }

        // Auth form handling
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded - Setting up auth handlers');
            
            // Auth tab switching
            document.querySelectorAll('[data-auth-tab]').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    console.log('Tab clicked:', tab.getAttribute('data-auth-tab'));
                    const tabName = tab.getAttribute('data-auth-tab');
                    
                    // Update tab appearance
                    document.querySelectorAll('[data-auth-tab]').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update form visibility
                    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                    document.getElementById(tabName + 'Form').classList.add('active');
                    
                    // Clear messages
                    document.getElementById('authMessage').innerHTML = '';
                    document.getElementById('registerMessage').innerHTML = '';
                });
            });

            // Real login form handler
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    console.log('Login form submitted');
                    
                    const formData = new FormData(e.target);
                    const email = formData.get('email');
                    const password = formData.get('password');
                    
                    console.log('Login attempt for:', email);
                    
                    const button = e.target.querySelector('.auth-button');
                    const originalText = button.textContent;
                    button.disabled = true;
                    button.textContent = 'Signing In...';
                    
                    try {
                        // Real API call
                        const success = await authManager.login(email, password);
                        
                        if (success) {
                            console.log('Login successful');
                            setTimeout(() => {
                                initializeSocket();
                            }, 1000);
                        } else {
                            console.log('Login failed');
                            button.disabled = false;
                            button.textContent = originalText;
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        button.disabled = false;
                        button.textContent = originalText;
                        authManager.showError('loginForm', 'Login failed. Please try again.');
                    }
                });
            }

            // Real register form handler
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    console.log('Register form submitted');
                    
                    const formData = new FormData(e.target);
                    const name = formData.get('name');
                    const email = formData.get('email');
                    const password = formData.get('password');
                    const confirmPassword = formData.get('confirmPassword');
                    
                    console.log('Registration attempt for:', name, email);
                    
                    const button = e.target.querySelector('.auth-button');
                    const originalText = button.textContent;
                    button.disabled = true;
                    button.textContent = 'Creating Account...';
                    
                    try {
                        // Real API call
                        const success = await authManager.register(name, email, password, confirmPassword);
                        
                        if (success) {
                            console.log('Registration successful');
                            setTimeout(() => {
                                initializeSocket();
                            }, 1000);
                        } else {
                            console.log('Registration failed');
                            button.disabled = false;
                            button.textContent = originalText;
                        }
                    } catch (error) {
                        console.error('Registration error:', error);
                        button.disabled = false;
                        button.textContent = originalText;
                        authManager.showError('registerForm', 'Registration failed. Please try again.');
                    }
                });
            }

            // Guest buttons - both login and register forms
            const guestButtons = [
                document.getElementById('guestButton'),
                document.getElementById('guestButtonRegister')
            ];
            
            guestButtons.forEach((button, index) => {
                if (button) {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`Guest button ${index + 1} clicked`);
                        authManager.continueAsGuest();
                        initializeSocket();
                    });
                }
            });

            // User menu functionality
            document.getElementById('userAvatar').addEventListener('click', (e) => {
                e.stopPropagation();
                const dropdown = document.getElementById('userDropdown');
                dropdown.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                document.getElementById('userDropdown').classList.remove('show');
            });

            // User menu items
            document.getElementById('profileMenuItem').addEventListener('click', () => {
                switchTab('profile');
                document.getElementById('userDropdown').classList.remove('show');
            });

            document.getElementById('settingsMenuItem').addEventListener('click', () => {
                switchTab('profile');
                document.getElementById('userDropdown').classList.remove('show');
            });

            document.getElementById('logoutMenuItem').addEventListener('click', () => {
                authManager.logout();
                document.getElementById('userDropdown').classList.remove('show');
            });

            // Initialize socket if user is already authenticated
            if (authManager.isAuthenticated()) {
                initializeSocket();
            }

            // Update session count display
            document.getElementById('sessionCount').textContent = sessionCount;
            loadMoodHistory();
            loadSettings();
            
            // Add welcome message when page loads
            setTimeout(() => {
                if (authManager.isAuthenticated() && messagesContainer.children.length === 0) {
                    const userName = authManager.currentUser.name;
                    const greeting = authManager.isGuest ? 
                        'Welcome! I\'m Empatha, your emotional wellness companion. How are you feeling today? üíô' :
                        `Welcome back, ${userName}! I\'m here to support your wellness journey. How are you feeling today? üíô`;
                    addMessage(greeting, false, 'caring');
                }
            }, 2000);
        });

        // Tab switching functionality
        function switchTab(sectionName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            document.getElementById(sectionName).classList.add('active');

            // Focus on message input when chat tab is selected
            if (sectionName === 'chat') {
                setTimeout(() => messageInput.focus(), 100);
            }
        }

        // Tab click handlers
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const sectionName = tab.getAttribute('data-section');
                switchTab(sectionName);
            });
        });

        // Chat functionality
        function addMessage(text, isUser = false, emotion = null, actions = []) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            
            const textDiv = document.createElement('div');
            textDiv.textContent = text;
            messageDiv.appendChild(textDiv);

            // Add emotion tag if provided
            if (emotion && !isUser) {
                const emotionTag = document.createElement('div');
                emotionTag.className = `message-tag emotion-${emotion}`;
                emotionTag.textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
                messageDiv.appendChild(emotionTag);
            }

            // Add actions if provided
            if (actions && actions.length > 0) {
                const actionsContainer = document.createElement('div');
                actionsContainer.className = 'actions-container';
                actions.forEach(action => {
                    const actionDiv = document.createElement('div');
                    actionDiv.className = `action-item action-${action.type}`;
                    actionDiv.textContent = action.message;
                    actionsContainer.appendChild(actionDiv);
                });
                messageDiv.appendChild(actionsContainer);
            }

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            removeTypingIndicator();
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = `
                <span class="typing-text">Empatha is thinking</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Event listeners for chat
        if (sendBtn) {
            sendBtn.addEventListener('click', sendMessage);
        }

        if (messageInput) {
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        // Mood selection functionality
        function updateMoodHistory() {
            const moodEntriesContainer = document.getElementById('moodEntries');
            moodEntriesContainer.innerHTML = '';
            
            if (moodEntries.length === 0) {
                moodEntriesContainer.innerHTML = '<div class="mood-entry"><span>No mood entries yet</span><span>Track your mood above</span></div>';
                return;
            }
            
            moodEntries.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'mood-entry';
                
                const moodEmoji = getMoodEmoji(entry.mood);
                entryDiv.innerHTML = `
                    <span>${moodEmoji} ${entry.label}</span>
                    <span style="color: rgba(255, 255, 255, 0.7);">${entry.displayTime}</span>
                `;
                
                moodEntriesContainer.appendChild(entryDiv);
            });
        }

        function getMoodEmoji(mood) {
            const emojiMap = {
                'very-happy': '‚òÄÔ∏è',
                'happy': 'üòä',
                'neutral': 'üòê',
                'sad': 'üò¢',
                'very-sad': '‚ö°'
            };
            return emojiMap[mood] || 'üòê';
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return diffMins <= 1 ? 'Just now' : `${diffMins} minutes ago`;
            if (diffHours < 24) return diffHours === 1 ? '1 hour ago' : `${diffHours} hours ago`;
            if (diffDays < 7) return diffDays === 1 ? 'Yesterday' : `${diffDays} days ago`;
            return date.toLocaleDateString();
        }

        document.querySelectorAll('.mood-option').forEach(option => {
            option.addEventListener('click', () => {
                // Remove selected class from all options
                document.querySelectorAll('.mood-option').forEach(opt => opt.classList.remove('selected'));
                // Add selected class to clicked option
                option.classList.add('selected');
                
                // Get mood data
                const mood = option.getAttribute('data-mood');
                const moodLabel = option.querySelector('.mood-label').textContent;
                
                // Add to mood history
                addMoodEntry(mood, moodLabel);
                
                // Show confirmation
                setTimeout(() => {
                    showNotification(`Mood "${moodLabel}" recorded! Thank you for sharing. üíô`);
                }, 500);
            });
        });

        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #8b5cf6, #a855f7);
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
                z-index: 1000;
                animation: slideInRight 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            // Add animation keyframes
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Toggle functionality for profile settings
        document.querySelectorAll('.toggle').forEach(toggle => {
            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                const setting = toggle.getAttribute('data-setting');
                
                // Save setting
                const isActive = toggle.classList.contains('active');
                
                // Update settings via auth manager
                updateUserSettings(setting, isActive);
            });
        });

        // Load saved settings
        function loadSettings() {
            // Load settings from localStorage or use defaults
            const savedSettings = authManager.currentUser?.settings || {};
            
            document.querySelectorAll('.toggle').forEach(toggle => {
                const setting = toggle.getAttribute('data-setting');
                
                // Check if setting is saved, otherwise use default
                const isActive = savedSettings[setting] !== undefined ? 
                    savedSettings[setting] : 
                    (setting === 'daily-checkins' || setting === 'mood-reminders');
                
                if (isActive) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            });
        }

        // Handle page visibility change
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && !isConnected && authManager.isAuthenticated()) {
                // Try to reconnect when page becomes visible
                initializeSocket();
            }
        });

        // Prevent form submission on enter
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.target !== messageInput && !e.target.closest('.auth-form')) {
                e.preventDefault();
            }
        });

        console.log('üöÄ Empatha with Real API Authentication initialized');
    </script>
</body>
</html>
